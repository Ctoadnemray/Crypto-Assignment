from cryptography import x509
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives.asymmetric import ec
import sys


def extract_ec_parameters(cert_path):
    with open(cert_path, "rb") as f:
        cert_data = f.read()

    cert = x509.load_pem_x509_certificate(cert_data, default_backend())
    public_key = cert.public_key()

    if not isinstance(public_key, ec.EllipticCurvePublicKey):
        print("[-] This certificate does NOT use EC-DSA.")
        return

    curve = public_key.curve
    public_numbers = public_key.public_numbers()
    curve_params = public_numbers.curve

    print("\n===== EC-DSA CERTIFICATE ANALYSIS =====")
    print(f"Curve Name           : {curve.name}")
    print(f"Key Size             : {curve.key_size} bits")

    if hasattr(curve_params, "p"):
        p = curve_params.p
        a = curve_params.a
        b = curve_params.b

        print("\n--- Finite Field ---")
        print("Field Type           : Prime Field GF(p)")
        print(f"Field Characteristic : p = {hex(p)}")

        print("\n--- Elliptic Curve Equation ---")
        print("y^2 = x^3 + ax + b  (mod p)")
        print(f"a = {hex(a)}")
        print(f"b = {hex(b)}")

    else:
        print("\n--- Finite Field ---")
        print("Field Type           : Binary Field GF(2^m)")
        print("Characteristic       : Defined by irreducible polynomial")

    print("\nâœ… Extraction completed successfully.")


if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python extract_ec_curve.py <certificate.pem>")
        sys.exit(1)

    extract_ec_parameters(sys.argv[1])
